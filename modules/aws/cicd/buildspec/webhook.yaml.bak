version: 0.2
phases:
  pre_build:
    commands:
      - echo "AWS: $AWS" # CodeBuild provides several environment variables that you can use in your build commands:
      - echo "AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION" # The AWS Region where the build is running (for example, us-east-1). This environment variable is used primarily by the AWS CLI.
      - echo "AWS_REGION: $AWS_REGION" # The AWS Region where the build is running (for example, us-east-1). This environment variable is used primarily by the AWS SDKs.
      - echo "CODEBUILD_BATCH_BUILD_IDENTIFIER: $CODEBUILD_BATCH_BUILD_IDENTIFIER" # The identifier of the build in a batch build. This is specified in the batch buildspec. For more information, see Batch build buildspec reference.
      - echo "CODEBUILD_BUILD_ARN: $CODEBUILD_BUILD_ARN" # The Amazon Resource Name (ARN) of the build (for example, arn:aws:codebuild:region-ID:account-ID:build/codebuild-demo-project:b1e6661e-e4f2-4156-9ab9-82a19EXAMPLE).
      - echo "CODEBUILD_BUILD_ID: $CODEBUILD_BUILD_ID" # The CodeBuild ID of the build (for example, codebuild-demo-project:b1e6661e-e4f2-4156-9ab9-82a19EXAMPLE).
      - echo "CODEBUILD_BUILD_IMAGE: $CODEBUILD_BUILD_IMAGE" # The CodeBuild build image identifier (for example, aws/codebuild/standard:2.0).
      - echo "CODEBUILD_BUILD_NUMBER: $CODEBUILD_BUILD_NUMBER" # The current build number for the project.
      - echo "CODEBUILD_BUILD_SUCCEEDING: $CODEBUILD_BUILD_SUCCEEDING" # Whether the current build is succeeding. Set to 0 if the build is failing, or 1 if the build is succeeding.
      - echo "CODEBUILD_INITIATOR: $CODEBUILD_INITIATOR" # The entity that started the build. If CodePipeline started the build, this is the pipeline's name (for example, codepipeline/my-demo-pipeline). If an IAM user started the build, this is the user's name (for example, MyUserName). If the Jenkins plugin for CodeBuild started the build, this is the string CodeBuild-Jenkins-Plugin.
      - echo "CODEBUILD_KMS_KEY_ID: $CODEBUILD_KMS_KEY_ID" # The identifier of the AWS KMS key that CodeBuild is using to encrypt the build output artifact (for example, arn:aws:kms:region-ID:account-ID:key/key-ID or alias/key-alias).
      - echo "CODEBUILD_LOG_PATH: $CODEBUILD_LOG_PATH" # The log stream name in CloudWatch Logs for the build.
      - echo "CODEBUILD_PUBLIC_BUILD_URL: $CODEBUILD_PUBLIC_BUILD_URL" # The URL of the build results for this build on the public builds website. This variable is only set if the build project has public builds enabled. For more information, see Public build projects in AWS CodeBuild.
      - echo "CODEBUILD_RESOLVED_SOURCE_VERSION: $CODEBUILD_RESOLVED_SOURCE_VERSION" # The version identifier of a build's source code. The contents depends on the source code repository:
      - echo "CodePipeline: $CodePipeline" # This variable contains the source revision provided by CodePipeline.
      - echo "CODEBUILD_SOURCE_REPO_URL: $CODEBUILD_SOURCE_REPO_URL" # The URL to the input artifact or source code repository. For Amazon S3, this is s3:// followed by the bucket name and path to the input artifact. For CodeCommit and GitHub, this is the repository's clone URL. If a build originates from CodePipeline, this environment variable may be empty.
      - echo "CODEBUILD_SOURCE_VERSION: $CODEBUILD_SOURCE_VERSION" # The value's format depends on the source repository.
      - echo "CODEBUILD_SRC_DIR: $CODEBUILD_SRC_DIR" # The directory path that CodeBuild uses for the build (for example, /tmp/src123456789/src).
      - echo "CODEBUILD_START_TIME: $CODEBUILD_START_TIME" # The start time of the build specified as a Unix timestamp in milliseconds.
      - echo "CODEBUILD_WEBHOOK_ACTOR_ACCOUNT_ID: $CODEBUILD_WEBHOOK_ACTOR_ACCOUNT_ID" # The account ID of the user that triggered the webhook event.
      - echo "CODEBUILD_WEBHOOK_BASE_REF: $CODEBUILD_WEBHOOK_BASE_REF" # The base reference name of the webhook event that triggers the current build. For a pull request, this is the branch reference.
      - echo "CODEBUILD_WEBHOOK_EVENT: $CODEBUILD_WEBHOOK_EVENT" # The webhook event that triggers the current build.
      - echo "CODEBUILD_WEBHOOK_MERGE_COMMIT: $CODEBUILD_WEBHOOK_MERGE_COMMIT" # The identifier of the merge commit used for the build. This variable is set when a Bitbucket pull request is merged with the squash strategy and the pull request branch is closed. In this case, the original pull request commit no longer exists, so this environment variable contains the identifier of the squashed merge commit.
      - echo "CODEBUILD_WEBHOOK_PREV_COMMIT: $CODEBUILD_WEBHOOK_PREV_COMMIT" # The ID of the most recent commit before the webhook push event that triggers the current build.
      - echo "CODEBUILD_WEBHOOK_HEAD_REF: $CODEBUILD_WEBHOOK_HEAD_REF" # The head reference name of the webhook event that triggers the current build. It can be a branch reference or a tag reference.
      - echo "CODEBUILD_WEBHOOK_TRIGGER: $CODEBUILD_WEBHOOK_TRIGGER" # Shows the webhook event that triggered the build. This variable is available only for builds triggered by a webhook. The value is parsed from the payload sent to CodeBuild by GitHub, GitHub Enterprise Server, or Bitbucket. The value's format depends on what type of event triggered the build.
      - echo "HOME: $HOME" # This environment variable is always set to /root.

      # - BRANCH_NAME=$(echo $CODEBUILD_WEBHOOK_HEAD_REF | sed -e "s/refs\///g" | sed -e "s/heads\///g" | sed -e "s/tags\///g" | sed -e "s/[\/]/-/g" | sed -e "s/[æøå]//g")
      # - SOURCE_URL=$(echo $CODEBUILD_SOURCE_REPO_URL | sed -e "s/https:\/\/bitbucket.org\///g" | sed -e "s/\.git//g")
  build:
    commands:
      - echo $CODEBUILD_WEBHOOK_HEAD_REF
      - echo "Commit Sha $CODEBUILD_RESOLVED_SOURCE_VERSION"
      - echo "Branch Name $BRANCH_NAME"
      - echo $CODEBUILD_RESOLVED_SOURCE_VERSION > commitInformation.txt
      - echo $BRANCH_NAME >> commitInformation.txt
      - echo $SOURCE_URL >> commitInformation.txt
      - echo $CODEBUILD_BUILD_NUMBER >> commitInformation.txt
      - cat commitInformation.txt
artifacts:
  files:
    - '**/*'


      - echo "AWS: $AWS"
      - echo "AWS_DEFAULT_REGION: $AWS_DEFAULT_REGION"
      - echo "AWS_REGION: $AWS_REGION"
      - echo "CODEBUILD_BATCH_BUILD_IDENTIFIER: $CODEBUILD_BATCH_BUILD_IDENTIFIER"
      - echo "CODEBUILD_BUILD_ARN: $CODEBUILD_BUILD_ARN"
      - echo "CODEBUILD_BUILD_ID: $CODEBUILD_BUILD_ID"
      - echo "CODEBUILD_BUILD_IMAGE: $CODEBUILD_BUILD_IMAGE"
      - echo "CODEBUILD_BUILD_NUMBER: $CODEBUILD_BUILD_NUMBER"
      - echo "CODEBUILD_BUILD_SUCCEEDING: $CODEBUILD_BUILD_SUCCEEDING"
      - echo "CODEBUILD_INITIATOR: $CODEBUILD_INITIATOR"
      - echo "CODEBUILD_KMS_KEY_ID: $CODEBUILD_KMS_KEY_ID"
      - echo "CODEBUILD_LOG_PATH: $CODEBUILD_LOG_PATH"
      - echo "CODEBUILD_PUBLIC_BUILD_URL: $CODEBUILD_PUBLIC_BUILD_URL"
      - echo "CODEBUILD_RESOLVED_SOURCE_VERSION: $CODEBUILD_RESOLVED_SOURCE_VERSION"
      - echo "CodePipeline: $CodePipeline"
      - echo "CODEBUILD_SOURCE_REPO_URL: $CODEBUILD_SOURCE_REPO_URL"
      - echo "CODEBUILD_SOURCE_VERSION: $CODEBUILD_SOURCE_VERSION"
      - echo "CODEBUILD_SRC_DIR: $CODEBUILD_SRC_DIR"
      - echo "CODEBUILD_START_TIME: $CODEBUILD_START_TIME"
      - echo "CODEBUILD_WEBHOOK_ACTOR_ACCOUNT_ID: $CODEBUILD_WEBHOOK_ACTOR_ACCOUNT_ID"
      - echo "CODEBUILD_WEBHOOK_BASE_REF: $CODEBUILD_WEBHOOK_BASE_REF"
      - echo "CODEBUILD_WEBHOOK_EVENT: $CODEBUILD_WEBHOOK_EVENT"
      - echo "CODEBUILD_WEBHOOK_MERGE_COMMIT: $CODEBUILD_WEBHOOK_MERGE_COMMIT"
      - echo "CODEBUILD_WEBHOOK_PREV_COMMIT: $CODEBUILD_WEBHOOK_PREV_COMMIT"
      - echo "CODEBUILD_WEBHOOK_HEAD_REF: $CODEBUILD_WEBHOOK_HEAD_REF"
      - echo "CODEBUILD_WEBHOOK_TRIGGER: $CODEBUILD_WEBHOOK_TRIGGER"



